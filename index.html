<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pixel World</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Arial;
  display:flex;
  flex-direction:column;
  height:100vh;
}
header{
  padding:10px;
  text-align:center;
  background:#111;
  font-weight:bold;
}
#palette{
  display:flex;
  gap:8px;
  padding:10px;
  overflow-x:auto;
  background:#111;
}
.color{
  width:32px;
  height:32px;
  border-radius:8px;
  border:2px solid #333;
}
.color.active{
  border-color:#fff;
}
#wrap{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
}
canvas{
  border:2px solid #222;
  image-rendering:pixelated;
  touch-action:none;
}
</style>
</head>

<body>

<header>Selam dostlar siteyi yeni açtım hata olabilir</header>

<div id="palette"></div>

<div id="wrap">
  <canvas id="canvas" width="998" height="998"></canvas>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const size = 10;
let currentColor = "#ff0000";

const colors = [
  "#ffffff","#000000","#ff0000","#00ff00","#0000ff",
  "#ffff00","#ff00ff","#00ffff","#ffa500","#964b00"
];

const palette = document.getElementById("palette");

colors.forEach(c => {
  const d = document.createElement("div");
  d.className = "color";
  d.style.background = c;
  if (c === currentColor) d.classList.add("active");
  d.onclick = () => {
    currentColor = c;
    document.querySelectorAll(".color").forEach(x => x.classList.remove("active"));
    d.classList.add("active");
  };
  palette.appendChild(d);
});

function drawGrid(){
  ctx.strokeStyle = "#222";
  for(let i=0;i<=32;i++){
    ctx.beginPath();
    ctx.moveTo(i*size,0);
    ctx.lineTo(i*size,320);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0,i*size);
    ctx.lineTo(320,i*size);
    ctx.stroke();
  }
}

function drawAll(data){
  ctx.clearRect(0,0,320,320);
  for(const k in data){
    const [x,y] = k.split(",");
    ctx.fillStyle = data[k];
    ctx.fillRect(x*size, y*size, size, size);
  }
  drawGrid();
}

fetch("/pixels").then(r=>r.json()).then(drawAll);

function place(e){
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) / size);
  const y = Math.floor((e.clientY - rect.top) / size);

  // anında çiz
  ctx.fillStyle = currentColor;
  ctx.fillRect(x*size, y*size, size, size);
  drawGrid();

  // server'a gönder
  fetch("/pixel",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({x,y,color:currentColor})
  });
}

canvas.addEventListener("click", place);
canvas.addEventListener("touchstart", e=>{
  e.preventDefault();
  place(e.touches[0]);
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixel Site</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body {
  margin: 0;
  background: #111;
  color: white;
  overflow: hidden;
  font-family: Arial;
}

#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 10;
  background: #222;
  padding: 10px;
  border-radius: 10px;
}

canvas {
  background: #000;
  touch-action: none;
}
</style>
</head>
<body>

<div id="ui">
  <input type="color" id="color" value="#ff0000">
</div>

<canvas id="canvas"></canvas>

<script>
const socket = io();

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const GRID = 10;
let scale = 1;
let offsetX = 0;
let offsetY = 0;
let dragging = false;
let lastX, lastY;

const pixels = {};

function draw() {
  ctx.setTransform(scale, 0, 0, scale, offsetX, offsetY);
  ctx.clearRect(-offsetX, -offsetY, canvas.width, canvas.height);

  for (let key in pixels) {
    const [x, y] = key.split(",").map(Number);
    ctx.fillStyle = pixels[key];
    ctx.fillRect(x * GRID, y * GRID, GRID, GRID);
  }
}

socket.on("init", (data) => {
  Object.assign(pixels, data);
  draw();
});

socket.on("pixel", (data) => {
  pixels[`${data.x},${data.y}`] = data.color;
  draw();
});

canvas.addEventListener("mousedown", e => {
  dragging = true;
  lastX = e.clientX;
  lastY = e.clientY;
});

canvas.addEventListener("mouseup", () => dragging = false);
canvas.addEventListener("mouseleave", () => dragging = false);

canvas.addEventListener("mousemove", e => {
  if (dragging) {
    offsetX += e.clientX - lastX;
    offsetY += e.clientY - lastY;
    lastX = e.clientX;
    lastY = e.clientY;
    draw();
  }
});

canvas.addEventListener("wheel", e => {
  scale += e.deltaY * -0.001;
  scale = Math.min(Math.max(0.3, scale), 5);
  draw();
});

canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - offsetX) / (GRID * scale));
  const y = Math.floor((e.clientY - offsetY) / (GRID * scale));
  const color = document.getElementById("color").value;

  pixels[`${x},${y}`] = color;
  socket.emit("pixel", { x, y, color });
  draw();
});
</script>

</body>
</html>
